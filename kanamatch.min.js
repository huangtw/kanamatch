const h=80;const n=h;const t=4;const s=4;const a=10;const l=5;const e=h*t+l*(t-1)+a*2;const i=n*s+l*(s-1)+a*2;const u=12;const o=40;const c=30;const S=3029058;const w=5068383;const p=8303235;const k=247614553;const r="#5494C7";const d="#CC90C6";const m="#F7A543";const g="#21262A";let f;window.onload=function(){let t={width:e,height:i,scene:T,backgroundColor:g,scale:{autoCenter:Phaser.Scale.CENTER_BOTH}};f=new Phaser.Game(t)};class T extends Phaser.Scene{constructor(){super("KanaMatch");this.tiles=[];this.kanaSets=[];this.selectedTiles=new Phaser.Structs.Set}preload(){}create(){this.buildKanas();for(let h=0;h<t;h++){for(let i=0;i<s;i++){let[t,s]=this.getPosition(h,i);let e=new C(this,t,s);this.tiles.push(e)}}this.fillTiles();this.input.on("gameobjectdown",this.onGameObjectDown,this)}onGameObjectDown(t,s){let e=s.data.values.tile;e.onClick();if(e.isSelected){this.selectedTiles.set(e)}else{this.selectedTiles.delete(e)}if(this.selectedTiles.size==3){let t=this.checkMatch();let s=t?p:k;this.selectedTiles.each(function(t){t.setTileColor(s)});this.time.delayedCall(300,function(){if(t){this.fillTiles()}this.selectedTiles.each(function(t){t.setIsSelected(false)});this.selectedTiles.clear()},[],this)}}checkMatch(){if(this.selectedTiles.size!=3){return false}let t=this.selectedTiles.getArray();return t[0].item.set===t[1].item.set&&t[1].item.set===t[2].item.set&&(t[0].item!==t[1].item&&t[1].item!==t[2].item&&t[0].item!==t[2].item)}getPosition(t,s){let e=a+s*(h+l)+.5*h;let i=a+t*(n+l)+.5*h;return[e,i]}buildKanas(){this.kanaSets.push(new y(this,"あ",o,"ア",o,"a",c));this.kanaSets.push(new y(this,"い",o,"イ",o,"i",c));this.kanaSets.push(new y(this,"う",o,"ウ",o,"u",c));this.kanaSets.push(new y(this,"え",o,"エ",o,"e",c));this.kanaSets.push(new y(this,"お",o,"オ",o,"o",c));this.kanaSets.push(new y(this,"か",o,"カ",o,"ka",c));this.kanaSets.push(new y(this,"き",o,"キ",o,"ki",c));this.kanaSets.push(new y(this,"く",o,"ク",o,"ku",c));this.kanaSets.push(new y(this,"け",o,"ケ",o,"ke",c));this.kanaSets.push(new y(this,"こ",o,"コ",o,"ko",c));this.kanaSets.push(new y(this,"さ",o,"サ",o,"sa",c));this.kanaSets.push(new y(this,"し",o,"シ",o,"shi",c));this.kanaSets.push(new y(this,"す",o,"ス",o,"su",c));this.kanaSets.push(new y(this,"せ",o,"セ",o,"se",c));this.kanaSets.push(new y(this,"そ",o,"ソ",o,"so",c));this.kanaSets.push(new y(this,"た",o,"タ",o,"ta",c));this.kanaSets.push(new y(this,"ち",o,"チ",o,"chi",c));this.kanaSets.push(new y(this,"つ",o,"ツ",o,"tsu",c));this.kanaSets.push(new y(this,"て",o,"テ",o,"te",c));this.kanaSets.push(new y(this,"と",o,"ト",o,"to",c));this.kanaSets.push(new y(this,"な",o,"ナ",o,"na",c));this.kanaSets.push(new y(this,"に",o,"ニ",o,"ni",c));this.kanaSets.push(new y(this,"ぬ",o,"ヌ",o,"nu",c));this.kanaSets.push(new y(this,"ね",o,"ネ",o,"ne",c));this.kanaSets.push(new y(this,"の",o,"ノ",o,"no",c));this.kanaSets.push(new y(this,"は",o,"ハ",o,"ha",c));this.kanaSets.push(new y(this,"ひ",o,"ヒ",o,"hi",c));this.kanaSets.push(new y(this,"ふ",o,"フ",o,"fu",c));this.kanaSets.push(new y(this,"へ",o,"ヘ",o,"he",c));this.kanaSets.push(new y(this,"ほ",o,"ホ",o,"ho",c));this.kanaSets.push(new y(this,"ま",o,"マ",o,"ma",c));this.kanaSets.push(new y(this,"み",o,"ミ",o,"mi",c));this.kanaSets.push(new y(this,"む",o,"ム",o,"mu",c));this.kanaSets.push(new y(this,"め",o,"メ",o,"me",c));this.kanaSets.push(new y(this,"も",o,"モ",o,"mo",c));this.kanaSets.push(new y(this,"や",o,"ヤ",o,"ya",c));this.kanaSets.push(new y(this,"ゆ",o,"ユ",o,"yu",c));this.kanaSets.push(new y(this,"よ",o,"ヨ",o,"yo",c));this.kanaSets.push(new y(this,"ら",o,"ラ",o,"ra",c));this.kanaSets.push(new y(this,"り",o,"リ",o,"ri",c));this.kanaSets.push(new y(this,"る",o,"ル",o,"ru",c));this.kanaSets.push(new y(this,"れ",o,"レ",o,"re",c));this.kanaSets.push(new y(this,"ろ",o,"ロ",o,"ro",c));this.kanaSets.push(new y(this,"わ",o,"ワ",o,"wa",c));this.kanaSets.push(new y(this,"を",o,"ヲ",o,"wo",c));this.kanaSets.push(new y(this,"ん",o,"ン",o,"n",c));this.kanaSets.push(new y(this,"が",o,"ガ",o,"ga",c));this.kanaSets.push(new y(this,"ぎ",o,"ギ",o,"gi",c));this.kanaSets.push(new y(this,"ぐ",o,"グ",o,"gu",c));this.kanaSets.push(new y(this,"げ",o,"ゲ",o,"ge",c));this.kanaSets.push(new y(this,"ご",o,"ゴ",o,"go",c));this.kanaSets.push(new y(this,"ざ",o,"ザ",o,"za",c));this.kanaSets.push(new y(this,"じ",o,"ジ",o,"ji",c));this.kanaSets.push(new y(this,"ず",o,"ズ",o,"zu",c));this.kanaSets.push(new y(this,"ぜ",o,"ゼ",o,"ze",c));this.kanaSets.push(new y(this,"ぞ",o,"ゾ",o,"zo",c));this.kanaSets.push(new y(this,"だ",o,"ダ",o,"da",c));this.kanaSets.push(new y(this,"ぢ",o,"ヂ",o,"ji\n(di)",c));this.kanaSets.push(new y(this,"づ",o,"ヅ",o,"zu\n(du)",c));this.kanaSets.push(new y(this,"で",o,"デ",o,"de",c));this.kanaSets.push(new y(this,"ど",o,"ド",o,"do",c));this.kanaSets.push(new y(this,"ば",o,"バ",o,"ba",c));this.kanaSets.push(new y(this,"び",o,"ビ",o,"bi",c));this.kanaSets.push(new y(this,"ぶ",o,"ボ",o,"bu",c));this.kanaSets.push(new y(this,"べ",o,"ベ",o,"be",c));this.kanaSets.push(new y(this,"ぼ",o,"ボ",o,"bo",c));this.kanaSets.push(new y(this,"ぱ",o,"パ",o,"pa",c));this.kanaSets.push(new y(this,"ぴ",o,"ピ",o,"pi",c));this.kanaSets.push(new y(this,"ぷ",o,"プ",o,"pu",c));this.kanaSets.push(new y(this,"ぺ",o,"ペ",o,"pe",c));this.kanaSets.push(new y(this,"ぽ",o,"ポ",o,"po",c))}fillTiles(){let i=[...this.tiles];let e=Phaser.Utils.Array.GetRandom(this.kanaSets);for(var h=0;h<e.items.length;h++){let t=Phaser.Utils.Array.RemoveRandomElement(i);let s=e.items[h];t.setKanaItem(s)}let n=Phaser.Math.Between(0,2);while(i.length>0){let t=Phaser.Utils.Array.RemoveRandomElement(i);let s=Phaser.Utils.Array.GetRandom(this.kanaSets);let e=s.items[n];t.setKanaItem(e);n=(n+1)%3}}}class C{constructor(t,s,e){this.scene=t;this.isSelected=false;this.item=null;this.container=this.scene.add.container(s,e);this.rectangle=this.scene.add.rectangle(0,0,h,n);this.text=this.scene.add.text(0,0," ",{padding:{x:u,y:u}});this.text.setOrigin(.5,.5);this.text.setAlign("center");this.text.setLineSpacing(-4);this.container.add(this.rectangle);this.container.add(this.text);this.container.setSize(h,n);this.container.setInteractive();this.container.setData("tile",this);this.updateTileColor()}setKanaItem(t){this.item=t;this.text.setText(t.text);this.text.setFontSize(t.fontSize);this.text.setColor(t.color)}onClick(){this.setIsSelected(!this.isSelected)}setIsSelected(t){this.isSelected=t;this.updateTileColor()}setTileColor(t){this.rectangle.setFillStyle(t)}updateTileColor(){if(this.isSelected){this.rectangle.setFillStyle(w)}else{this.rectangle.setFillStyle(S)}}}class x{constructor(t,s,e,i){this.text=t;this.fontSize=s;this.color=e;this.set=i}}class y{constructor(t,s,e,i,h,n,a){this.scene=t;let l=new x(s,e,r,this);let u=new x(i,h,d,this);let o=new x(n,a,m,this);this.items=[l,u,o]}}