const h=80;const n=h;const s=4;const e=4;const a=10;const c=5;const o=100;const t=h*s+c*(s-1)+a*2;const i=n*e+c*(e-1)+a*2;const l=t;const r=o+i;const u=12;const S=40;const d=30;const p=3029058;const w=4872549;const k=8303235;const m=12733529;const g="#5494C7";const x="#CC90C6";const T="#F7A543";const f="#21262A";const C=300;const z="#D6DCE8";const P=40;const b=4872549;const y="#D6DCE8";const A=25;const D=100;const E=60;const I=160;const O=60;const R="#D6DCE8";const M=3029058;const j=40;const v=160;const U=40;const F="#D6DCE8";const B=3029058;const H=27;const L=30;const N="#F7A543";let _;window.onload=function(){let t={width:l,height:r,scene:[q,Q,J],backgroundColor:f,scale:{autoCenter:Phaser.Scale.CENTER_BOTH}};_=new Phaser.Game(t)};class q extends Phaser.Scene{constructor(){super("StartGame")}create(){let t=this.add.container(l/2,r/2);let s=this.add.text(0,0,"Start",{fontSize:j,color:R});s.setOrigin(.5,.5);s.setAlign("center");t.add(s);t.setSize(I,O);t.setInteractive();this.input.on("gameobjectdown",function(){this.scene.start("KanaMatch")},this)}}class J extends Phaser.Scene{constructor(){super("EndGame")}init(t){this.score=t.score}create(){let t=this.add.text(l/2,r/2,"Score "+this.score,{fontSize:L,color:N});t.setOrigin(.5,.5);t.setAlign("center");let s=this.add.container(l/2,r/2+80);let e=this.add.text(0,0,"Try again",{fontSize:H,color:F});e.setOrigin(.5,.5);e.setAlign("center");s.add(this.add.rectangle(0,0,v,U,B));s.add(e);s.setSize(v,O);s.setInteractive();this.input.on("gameobjectdown",function(){this.scene.start("KanaMatch")},this)}}class Q extends Phaser.Scene{constructor(){super("KanaMatch")}create(){this.tiles=[];this.kanaSets=[];this.selectedTiles=new Phaser.Structs.Set;this.buildKanas();for(let h=0;h<s;h++){for(let i=0;i<e;i++){let[t,s]=this.getPosition(h,i);let e=new V(this,t,s);this.tiles.push(e)}}this.fillTiles();this.input.on("gameobjectdown",this.onGameObjectDown,this);this.timer=this.time.addEvent({delay:C*1e3,callback:function(){this.scene.start("EndGame",{score:this.score})},callbackScope:this});this.timerText=this.add.text(l/2,o/2," ",{fontSize:P,color:z});this.timerText.setOrigin(.5,.5);this.timerText.setAlign("center");this.scoreText=this.add.text(0,0,0,{fontSize:A,color:y});this.scoreText.setOrigin(.5,.5);this.scoreText.setAlign("center");let t=this.add.container(D/2+a,E/2+a);t.add(this.add.rectangle(0,0,D,E,b));t.add(this.scoreText);t.setSize(D,E);this.updateScore(0)}update(){let t=Math.ceil(this.timer.getRemainingSeconds());let s=Math.floor(t/60);let e=t%60;console.log(s+":"+Phaser.Utils.String.Pad(e,2,"0",1)+" - "+this.timer.getRemainingSeconds());this.timerText.setText(Phaser.Utils.String.Pad(s,2,"0",1)+":"+Phaser.Utils.String.Pad(e,2,"0",1))}updateScore(t){this.score=t;this.scoreText.setText("score\n"+this.score)}onGameObjectDown(t,s){let e=s.data.values.tile;e.onClick();if(e.isSelected){this.selectedTiles.set(e)}else{this.selectedTiles.delete(e)}if(this.selectedTiles.size==3){let t=this.checkMatch();let s=t?k:m;this.selectedTiles.each(function(t){t.setTileColor(s)});this.time.delayedCall(300,function(){if(t){this.updateScore(this.score+1);this.fillTiles()}this.selectedTiles.each(function(t){t.setIsSelected(false)});this.selectedTiles.clear()},[],this)}}checkMatch(){if(this.selectedTiles.size!=3){return false}let t=this.selectedTiles.getArray();return t[0].item.set===t[1].item.set&&t[1].item.set===t[2].item.set&&(t[0].item!==t[1].item&&t[1].item!==t[2].item&&t[0].item!==t[2].item)}getPosition(t,s){let e=a+s*(h+c)+.5*h;let i=o+a+t*(n+c)+.5*h;return[e,i]}buildKanas(){this.kanaSets.push(new K(this,"あ",S,"ア",S,"a",d));this.kanaSets.push(new K(this,"い",S,"イ",S,"i",d));this.kanaSets.push(new K(this,"う",S,"ウ",S,"u",d));this.kanaSets.push(new K(this,"え",S,"エ",S,"e",d));this.kanaSets.push(new K(this,"お",S,"オ",S,"o",d));this.kanaSets.push(new K(this,"か",S,"カ",S,"ka",d));this.kanaSets.push(new K(this,"き",S,"キ",S,"ki",d));this.kanaSets.push(new K(this,"く",S,"ク",S,"ku",d));this.kanaSets.push(new K(this,"け",S,"ケ",S,"ke",d));this.kanaSets.push(new K(this,"こ",S,"コ",S,"ko",d));this.kanaSets.push(new K(this,"さ",S,"サ",S,"sa",d));this.kanaSets.push(new K(this,"し",S,"シ",S,"shi",d));this.kanaSets.push(new K(this,"す",S,"ス",S,"su",d));this.kanaSets.push(new K(this,"せ",S,"セ",S,"se",d));this.kanaSets.push(new K(this,"そ",S,"ソ",S,"so",d));this.kanaSets.push(new K(this,"た",S,"タ",S,"ta",d));this.kanaSets.push(new K(this,"ち",S,"チ",S,"chi",d));this.kanaSets.push(new K(this,"つ",S,"ツ",S,"tsu",d));this.kanaSets.push(new K(this,"て",S,"テ",S,"te",d));this.kanaSets.push(new K(this,"と",S,"ト",S,"to",d));this.kanaSets.push(new K(this,"な",S,"ナ",S,"na",d));this.kanaSets.push(new K(this,"に",S,"ニ",S,"ni",d));this.kanaSets.push(new K(this,"ぬ",S,"ヌ",S,"nu",d));this.kanaSets.push(new K(this,"ね",S,"ネ",S,"ne",d));this.kanaSets.push(new K(this,"の",S,"ノ",S,"no",d));this.kanaSets.push(new K(this,"は",S,"ハ",S,"ha",d));this.kanaSets.push(new K(this,"ひ",S,"ヒ",S,"hi",d));this.kanaSets.push(new K(this,"ふ",S,"フ",S,"fu",d));this.kanaSets.push(new K(this,"へ",S,"ヘ",S,"he",d));this.kanaSets.push(new K(this,"ほ",S,"ホ",S,"ho",d));this.kanaSets.push(new K(this,"ま",S,"マ",S,"ma",d));this.kanaSets.push(new K(this,"み",S,"ミ",S,"mi",d));this.kanaSets.push(new K(this,"む",S,"ム",S,"mu",d));this.kanaSets.push(new K(this,"め",S,"メ",S,"me",d));this.kanaSets.push(new K(this,"も",S,"モ",S,"mo",d));this.kanaSets.push(new K(this,"や",S,"ヤ",S,"ya",d));this.kanaSets.push(new K(this,"ゆ",S,"ユ",S,"yu",d));this.kanaSets.push(new K(this,"よ",S,"ヨ",S,"yo",d));this.kanaSets.push(new K(this,"ら",S,"ラ",S,"ra",d));this.kanaSets.push(new K(this,"り",S,"リ",S,"ri",d));this.kanaSets.push(new K(this,"る",S,"ル",S,"ru",d));this.kanaSets.push(new K(this,"れ",S,"レ",S,"re",d));this.kanaSets.push(new K(this,"ろ",S,"ロ",S,"ro",d));this.kanaSets.push(new K(this,"わ",S,"ワ",S,"wa",d));this.kanaSets.push(new K(this,"を",S,"ヲ",S,"wo",d));this.kanaSets.push(new K(this,"ん",S,"ン",S,"n",d));this.kanaSets.push(new K(this,"が",S,"ガ",S,"ga",d));this.kanaSets.push(new K(this,"ぎ",S,"ギ",S,"gi",d));this.kanaSets.push(new K(this,"ぐ",S,"グ",S,"gu",d));this.kanaSets.push(new K(this,"げ",S,"ゲ",S,"ge",d));this.kanaSets.push(new K(this,"ご",S,"ゴ",S,"go",d));this.kanaSets.push(new K(this,"ざ",S,"ザ",S,"za",d));this.kanaSets.push(new K(this,"じ",S,"ジ",S,"ji",d));this.kanaSets.push(new K(this,"ず",S,"ズ",S,"zu",d));this.kanaSets.push(new K(this,"ぜ",S,"ゼ",S,"ze",d));this.kanaSets.push(new K(this,"ぞ",S,"ゾ",S,"zo",d));this.kanaSets.push(new K(this,"だ",S,"ダ",S,"da",d));this.kanaSets.push(new K(this,"ぢ",S,"ヂ",S,"ji\n(di)",d));this.kanaSets.push(new K(this,"づ",S,"ヅ",S,"zu\n(du)",d));this.kanaSets.push(new K(this,"で",S,"デ",S,"de",d));this.kanaSets.push(new K(this,"ど",S,"ド",S,"do",d));this.kanaSets.push(new K(this,"ば",S,"バ",S,"ba",d));this.kanaSets.push(new K(this,"び",S,"ビ",S,"bi",d));this.kanaSets.push(new K(this,"ぶ",S,"ボ",S,"bu",d));this.kanaSets.push(new K(this,"べ",S,"ベ",S,"be",d));this.kanaSets.push(new K(this,"ぼ",S,"ボ",S,"bo",d));this.kanaSets.push(new K(this,"ぱ",S,"パ",S,"pa",d));this.kanaSets.push(new K(this,"ぴ",S,"ピ",S,"pi",d));this.kanaSets.push(new K(this,"ぷ",S,"プ",S,"pu",d));this.kanaSets.push(new K(this,"ぺ",S,"ペ",S,"pe",d));this.kanaSets.push(new K(this,"ぽ",S,"ポ",S,"po",d))}fillTiles(){let i=[...this.tiles];let e=Phaser.Utils.Array.GetRandom(this.kanaSets);for(var h=0;h<e.items.length;h++){let t=Phaser.Utils.Array.RemoveRandomElement(i);let s=e.items[h];t.setKanaItem(s)}let n=Phaser.Math.Between(0,2);while(i.length>0){let t=Phaser.Utils.Array.RemoveRandomElement(i);let s=Phaser.Utils.Array.GetRandom(this.kanaSets);let e=s.items[n];t.setKanaItem(e);n=(n+1)%3}}}class V{constructor(t,s,e){this.scene=t;this.isSelected=false;this.item=null;this.container=this.scene.add.container(s,e);this.rectangle=this.scene.add.rectangle(0,0,h,n);this.text=this.scene.add.text(0,0," ",{padding:{x:u,y:u}});this.text.setOrigin(.5,.5);this.text.setAlign("center");this.text.setLineSpacing(-4);this.container.add(this.rectangle);this.container.add(this.text);this.container.setSize(h,n);this.container.setInteractive();this.container.setData("tile",this);this.updateTileColor()}setKanaItem(t){this.item=t;this.text.setText(t.text);this.text.setFontSize(t.fontSize);this.text.setColor(t.color)}onClick(){this.setIsSelected(!this.isSelected)}setIsSelected(t){this.isSelected=t;this.updateTileColor()}setTileColor(t){this.rectangle.setFillStyle(t)}updateTileColor(){if(this.isSelected){this.rectangle.setFillStyle(w)}else{this.rectangle.setFillStyle(p)}}}class G{constructor(t,s,e,i){this.text=t;this.fontSize=s;this.color=e;this.set=i}}class K{constructor(t,s,e,i,h,n,a){this.scene=t;let c=new G(s,e,g,this);let o=new G(i,h,x,this);let l=new G(n,a,T,this);this.items=[c,o,l]}}